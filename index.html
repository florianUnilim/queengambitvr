
<html>
    
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,shrink-to-fit=no,user-scalable=no,maximum-scale=1"
    />
    <title>Queen Gambit</title>
  
    
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>
    <script>
      AFRAME.registerComponent('show-chess', {
        init: function () {
          let el = this.el;
    
          // Ajoute un écouteur pour les clics normaux (souris et écran)
          el.addEventListener('click', () => this.triggerAction());
    
          // Ajoute un écouteur pour les manettes VR (quand on appuie sur la gâchette)
          el.addEventListener('triggerdown', () => this.triggerAction());
        },
    
        triggerAction: function () {
          let dialogBox = document.querySelector('#dialogBox');
          let dialogBox2 = document.querySelector('#dialogBox2');
          let pieces = document.querySelectorAll('.chess-piece');
          let fadePlane = document.querySelector('#fadePlane');
          let rig = document.querySelector('#rig');
    
          // Position et rotation du spawn (à ajuster selon ton projet)
          let spawnPosition = new THREE.Vector3(-0.33, 0, 0);
          let spawnRotation = new THREE.Euler(0, Math.PI, 0); // Rotation en radians
    
          // 1️⃣ Cacher la boîte de dialogue immédiatement
          if (dialogBox) {
            dialogBox.setAttribute('visible', 'false');
            setTimeout(() => {
        dialogBox2.setAttribute('visible', 'true');
      }, 1000);
          }
    
          // 2️⃣ Activer le fondu noir
          fadePlane.setAttribute('visible', 'true');
          fadePlane.setAttribute('animation', 'property: material.opacity; from: 0; to: 1; dur: 1000;');
    
          // 3️⃣ Attendre la fin du fondu noir
          setTimeout(() => {
            // Afficher les pièces d'échecs
            pieces.forEach(piece => piece.setAttribute('visible', 'true'));
    
            // 4️⃣ Téléporter l'utilisateur exactement au spawn
            rig.object3D.position.copy(spawnPosition);
            rig.object3D.rotation.set(spawnRotation.x, spawnRotation.y, spawnRotation.z);
    
            // 5️⃣ Dissiper le fondu noir
            fadePlane.setAttribute('animation', 'property: material.opacity; from: 1; to: 0; dur: 1000;');
    
            // Cacher le fondu noir après l'animation
            setTimeout(() => {
              fadePlane.setAttribute('visible', 'false');
            }, 1000);
          }, 1000);
        }
      });
    </script>
    
    
    
    

</head>
  <body>
    <a-scene fog="type: exponential; color: #000; density: 0.3" vr-mode-ui="enabled: true">
        <a-animation attribute="position" to="0-0.33 1.3 -1.80" dur="5000" repeat="indefinite"></a-animation>
        

        <a-entitY
       gltf-model="./assets/board.glb" 
       position="2.707 1 -1.055" 
       rotation="0 180 0" 
       scale="2 2 2">
  </a-entitY>

        <a-entity id="dialogBox" visible="true" geometry="primitive: plane; height: 0.5; width: 1.5" 
        material=""
        position="2.747 1.460 -1.325"
        rotation="0 -90 0"
        text="value: [Quete principale]
        Un esprit trouble
        Objectif : Prenez vos pilules de Xanzolam pour retrouver vos esprits.; color: black ; align: center">
        </a-entity>

        <a-entity id="dialogBox2"visible="false"  geometry="primitive: plane; width: 0.5; height: 1.5" 
          material="" 
          position="2.747 1.460 -1.325" 
          rotation="0 -90 0"
          text="value: [Quete principale]
          la memoire
          Je dois me souvenir...\nCette partie au plafond...\nPassons par la porte pour voir la suite !;
          align : center; color : black; width:1.8">
  </text>
</a-entity>

        <a-image 
        src="./assets/chesspartie.jpg" 
        position="2.705 2.009 -0.227" 
        rotation="0 -90 0"
        scale="0.5 0.5 0.5"
        width="1" 
        height="1">
      </a-image>

        <a-assets>
        <a-asset-item
       id="navmesh"
       src="./assets/navmesh.glb"
     ></a-asset-item>

     <a-asset-item
          id="piece"
          src="./assets/mur2.glb"
        ></a-asset-item>
      </a-assets>
    </a-assets>

<a-entity id="rig" movement-controls="constrainToNavMesh: true;"  >
    <a-entity
      camera
      position="-0.33 1.3 0"
      
      look-controls="pointerLockEnabled: true"     
    >
    <a-plane 
      id="fadePlane"
      material="color: black; shader: flat; opacity: 0"
      position="0 0 -0.1"
      width="2" height="2"
      visible="false">
    </a-plane>

      <a-cursor></a-cursor>

    </a-entity>

    <a-entity
    occulus-touch-controls="hand: left"
      laser-controls="hand: right"
      raycaster="objects: .collidable, .clickable; showline: true; far: 10"
      line="color: red"
    ></a-entity>

    <a-entity
    occulus-touch-controls="hand: right"
      laser-controls="hand: left"
      raycaster="objects: .collidable, .clickable; showline: true; far: 10"
      line="color: red"
    ></a-entity>

  </a-entity>
    
      <!-- salle 2 - chambre -->      

      <a-entity 
      id="fadePlane"
      geometry="primitive: plane; height: 2; width: 2"
      material="color: black; shader: flat; opacity: 0"
      position="0 1.5 -1"
      rotation="0 0 0"
      visible="false">
    </a-entity>
       <!-- Nav mesh. -->
      <a-entity
      nav-mesh
      normal-material
      visible="false"
      position="-4.036 0.05 1.625"
      rotation="0 180 0"
      scale="0.73 0.75 0.73"
      gltf-model="#navmesh"
    ></a-entity>

    <a-entity 
    gltf-model="#piece" 
    position="-4.3 -0.019 1.8" 
    rotation="0 180 0" 
    scale="0.79 0.5 0.77"
    visible="true">
  </a-entity>


  
       <a-entity 
       gltf-model="./assets/solm.glb" 
       position="-4.687 -0.422 1.570" 
       rotation="0 0 0" 
       scale="1.4 1.5 1"
       visible="true">
     </a-entity>

    <a-entity 
      gltf-model="./assets/bed.glb" 
      position="-0.893 0.044 0" 
      rotation="0 180 0" 
      scale="0.75 0.5 0.75">
    </a-entity>

    <a-entity 
      gltf-model="./assets/tablenuit.glb" 
      position="-1.805 0.018 0.740" 
      rotation="0 180 0" 
      scale="0.75 0.5 0.75">
    </a-entity>

    
    <a-entity 
    class="clickable"
  event-set__click="_target: .chess-piece; visible: true"
       gltf-model="./assets/pill.glb" 
       position="-1.90 0.46 0.66" 
       rotation="0 0 0" 
       scale="1 1 1"
       show-chess>

     </a-entity >
     <a-entity
     class="clickable"
  event-set__click="_target: .chess-piece; visible: true" 
       gltf-model="./assets/pill.glb" 
       position="-1.92 0.46 0.67" 
       rotation="50 90 0" 
       scale="1 1 1"
       show-chess>
     </a-entity>

     <a-entity 
     class="clickable"
  event-set__click="_target: .chess-piece; visible: true"
       gltf-model="./assets/pillbottle.glb" 
       position="-1.84 0.46 0.66" 
       rotation="0 0 0" 
       scale="1 1 1"
       show-chess>
     </a-entity>

     <a-entity 
     class="clickable"
  event-set__click="_target: .chess-piece; visible: true"
       gltf-model="./assets/pill.glb" 
       position="-1.87 0.46 0.66" 
       rotation="0 0 0" 
       scale="1 1 1"
       show-chess>
     </a-entity>

     <a-entity 
     class="clickable"
  event-set__click="_target: .chess-piece; visible: true"
       gltf-model="./assets/pillbottle.glb" 
       position="-1.78 0.46 0.65" 
       rotation="90 57 0" 
       scale="1 1 1"
       show-chess>
     </a-entity>
    

    <a-entity 
      gltf-model="./assets/tablenuit.glb" 
      position="1.111 0.044 0.740" 
      rotation="0 180 0" 
      scale="0.75 0.5 0.75">
    </a-entity>

    <a-entity 
      gltf-model="./assets/chessset.glb" 
      position="1.108 0.528 0.702" 
      rotation="0 180 0" 
      scale="0.5 0.5 0.5">
    </a-entity>

    <a-entity 
      gltf-model="./assets/rug.glb" 
      position="1.190 0.047 -1.133" 
      rotation="0 180 0" 
      scale="0.5 0.5 0.5">
    </a-entity>


    <a-image 
        src="./assets/kasparov.jpg" 
        position="2.804 1.517 -3.650" 
        rotation="0 90 0"
        width="1" 
        height="1">
      </a-image>


      <!-- pièces déchecs -->


  
      <a-entity 
      class="chess-piece" 
      visible="false"
      gltf-model="./assets/chessboard.glb" 
      position="-0.435 2.553 -3" 
      rotation="180 0 0" 
      scale="5 1 5">
    </a-entity>

      <a-entity 
      class="chess-piece" 
      visible="false"
       gltf-model="./assets/rookb.glb" 
       position="-0.655 2.304 -4.468" 
       rotation="180 0 0" 
       scale="2.5 2.5 2.5">
     </a-entity>

     <a-entity
      class="chess-piece" 
      visible="false"
       gltf-model="./assets/knightw.glb" 
       position="0.129 2.347 -3.653" 
       rotation="180 0 0" 
       scale="0.3 0.3 0.3">
     </a-entity>

     <a-entity 
      class="chess-piece" 
      visible="false"
       gltf-model="./assets/bishopb.glb" 
       position="-0.25 2.213 -2.4" 
       rotation="180 0 0" 
       scale="2.5 2.5 2.5">
     </a-entity>

     <a-entity 
     class="chess-piece" 
     visible="false"
     gltf-model="./assets/pawnw.glb" 
     position="-1.4 2.304 -3.979" 
     rotation="180 0 0" 
     scale="1 1 1">
   </a-entity>

   <a-entity 
   class="chess-piece" 
   visible="false"
   gltf-model="./assets/pawnw.glb" 
   position="-1.06 2.304 -3.979" 
   rotation="180 0 0" 
   scale="1 1 1">
 </a-entity>

 <a-entity 
 class="chess-piece" 
  visible="false"
   gltf-model="./assets/pawnw.glb" 
   position="-1.8 2.304 -3.6" 
   rotation="180 0 0" 
   scale="1 1 1">
 </a-entity>

     <a-entity 
     class="chess-piece" 
  visible="false"
     gltf-model="./assets/kingw.glb" 
     position="-1.856 2.092 -4.468" 
     rotation="180 0 0" 
     scale="2 2 2">
   </a-entity>

   <a-entity 
   class="chess-piece" 
  visible="false"
   gltf-model="./assets/kingb.glb" 
   position="-1.856 2.092 -2" 
   rotation="180 0 0" 
   scale="2 2 2">
 </a-entity>

 <a-entity 
 class="chess-piece" 
  visible="false"
 gltf-model="./assets/pawnb.glb" 
 position="-1.856 2.304 -2.35" 
 rotation="180 0 0" 
 scale="2 2 2">
</a-entity>

<a-entity 
class="chess-piece" 
  visible="false"
gltf-model="./assets/pawnb.glb" 
position="-1.09 2.304 -2.35" 
rotation="180 0 0" 
scale="2 2 2">
</a-entity>

<a-entity 
class="chess-piece" 
  visible="false"
gltf-model="./assets/pawnb.glb" 
position="-1.40 2.304 -2" 
rotation="180 0 0" 
scale="2 2 2">
</a-entity>

      
      <a-sky color="#000"></a-sky>
    </a-scene>

    
  </body>
</html>